<!doctype html>
<html lang="zh-CN" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>æˆ‘çš„å¯¼èˆª</title>
  <style>
    /*
    =============================================
    ç§»åŠ¨ç«¯ç½‘é¡µå¯¼èˆªæ¨¡æ¿ï¼ˆå•æ–‡ä»¶ï¼Œå¯è‡ªå®šä¹‰é“¾æ¥ï¼‰
    â€” ä½¿ç”¨æ–¹å¼ â€”
    1ï¼‰ä¿®æ”¹ä¸‹æ–¹ LINKS_DEFAULT ä¸­çš„ç¤ºä¾‹é“¾æ¥å³å¯è‡ªå®šä¹‰å¯¼èˆªé¡¹ã€‚
    2ï¼‰é¡µé¢å³ä¸Šè§’â€œç¼–è¾‘â€å¯åœ¨æ‰‹æœºä¸Šæ·»åŠ /åˆ é™¤é“¾æ¥ï¼ˆæœ¬åœ°ä¿å­˜ï¼‰ã€‚
    3ï¼‰éœ€è¦é‡ç½®ä¸ºé»˜è®¤ç¤ºä¾‹ï¼Œç‚¹â€œæ›´å¤š â†’ æ¢å¤é»˜è®¤â€ã€‚
    4ï¼‰é…è‰²å¯æ”¹ï¼š:root ä¸­çš„ CSS å˜é‡ï¼Œæˆ–åˆ‡æ¢æ·±æµ…è‰²ã€‚
    =============================================
    */

    /* è®¾è®¡ä»¤ç‰Œï¼ˆä½ å¯ä»¥åœ¨è¿™é‡Œå¿«é€Ÿæ”¹ä¸»é¢˜ï¼‰ */
    :root {
      --bg: #0b1020;            /* èƒŒæ™¯ */
      --card: #121933;          /* å¡ç‰‡èƒŒæ™¯ */
      --card-press: #0f152b;    /* å¡ç‰‡æŒ‰ä¸‹ */
      --text: #e5ecff;          /* æ–‡å­— */
      --subtle: #9fb0ffcc;      /* æ¬¡è¦æ–‡å­— */
      --accent: #4f8cff;        /* é‡ç‚¹è‰²/æŒ‰é’® */
      --ring: #7aa2ff;          /* ç„¦ç‚¹æè¾¹ */
      --muted: #0a122b;         /* é¡¶æ /è¾“å…¥èƒŒæ™¯ */
      --border: #20305e;        /* è¾¹æ¡†çº¿ */
      --shadow: 0 6px 24px rgba(0,0,0,.35), 0 2px 6px rgba(0,0,0,.25);
      --radius: 18px;           /* ç»Ÿä¸€åœ†è§’ */
      --tap: 56px;              /* è§¦æ§ç›®æ ‡å¤§å° */
      --safe-bottom: env(safe-area-inset-bottom); /* iOS åº•éƒ¨å®‰å…¨åŒº */
    }

    /* äº®è‰²ä¸»é¢˜ï¼ˆå¯é€‰ï¼‰ */
    html[data-theme="light"] {
      --bg: #f6f7fb;
      --card: #ffffff;
      --card-press: #f3f5fb;
      --text: #0e1326;
      --subtle: #51607a;
      --accent: #245bff;
      --ring: #2a62ff;
      --muted: #eef2ff;
      --border: #e6e9f3;
      --shadow: 0 6px 24px rgba(13, 21, 40, .08), 0 2px 6px rgba(13, 21, 40, .05);
    }

    /* è·Ÿéšç³»ç»Ÿï¼ˆé»˜è®¤ï¼‰ */
    @media (prefers-color-scheme: light) {
      html[data-theme="auto"] { color-scheme: light; }
    }
    @media (prefers-color-scheme: dark) {
      html[data-theme="auto"] { color-scheme: dark; }
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(180deg, var(--bg), color-mix(in srgb, var(--bg), #000 6%));
      color: var(--text);
      -webkit-tap-highlight-color: transparent;
    }

    /* é¡¶æ  */
    .topbar {
      position: sticky; top: 0; z-index: 20;
      padding: 12px max(12px, env(safe-area-inset-left)) 10px max(12px, env(safe-area-inset-right));
      backdrop-filter: saturate(1.2) blur(10px);
      background: color-mix(in srgb, var(--bg), #000 20%);
      border-bottom: 1px solid var(--border);
      display: grid; grid-template-columns: 1fr auto auto; gap: 8px; align-items: center;
    }
    .title {
      font-weight: 700; letter-spacing: .4px; font-size: 18px;
      display: inline-flex; align-items: center; gap: 8px;
    }
    .title .badge { font-size: 11px; color: var(--subtle); border: 1px solid var(--border); padding: 2px 6px; border-radius: 999px; }

    .iconbtn {
      display: inline-grid; place-items: center; width: 38px; height: 38px; border-radius: 12px;
      background: var(--muted); border: 1px solid var(--border); color: var(--text);
      box-shadow: var(--shadow);
    }
    .iconbtn:active { transform: scale(.98); }

    /* æœç´¢æ¡† */
    .search-wrap { padding: 12px 12px 2px; }
    .search {
      display: flex; align-items: center; gap: 10px;
      background: var(--muted); border: 1px solid var(--border); border-radius: 14px;
      padding: 10px 12px;
    }
    .search input {
      flex: 1; background: transparent; border: none; outline: none; color: var(--text);
      font-size: 16px; min-height: 28px;
    }
    .search .key { font-size: 12px; color: var(--subtle); border: 1px solid var(--border); padding: 2px 6px; border-radius: 8px; }

    /* ç½‘æ ¼ */
    .grid { padding: 8px 12px calc(80px + var(--safe-bottom)); display: grid; gap: 12px; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); }
    .tile {
      position: relative;
      border-radius: var(--radius); overflow: hidden;
      background: radial-gradient(120% 140% at 10% 0%, color-mix(in srgb, var(--card), #fff 6%), var(--card));
      border: 1px solid var(--border); box-shadow: var(--shadow);
    }
    .tile a { display: grid; gap: 8px; justify-items: start; padding: 14px; text-decoration: none; color: inherit; }
    .tile:active { background: var(--card-press); transform: translateY(1px); }

    .emoji { font-size: 28px; line-height: 1; }
    .label { font-size: 15px; font-weight: 600; letter-spacing: .2px; }
    .url { font-size: 12px; color: var(--subtle); word-break: break-all; }

    /* åˆ é™¤æŒ‰é’®ï¼ˆç¼–è¾‘æ¨¡å¼ä¸‹å¯è§ï¼‰ */
    .del {
      position: absolute; top: 8px; right: 8px; width: 28px; height: 28px; border-radius: 999px;
      display: none; place-items: center; background: #ef4444; color: white; border: none; font-size: 16px; box-shadow: var(--shadow);
    }
    body[data-edit="1"] .del { display: grid; }

    /* åº•éƒ¨å·¥å…·æ  */
    .toolbar {
      position: fixed; left: 0; right: 0; bottom: 0; z-index: 30;
      display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; align-items: center; padding: 10px 12px calc(10px + var(--safe-bottom));
      background: color-mix(in srgb, var(--bg), #000 20%); border-top: 1px solid var(--border);
      backdrop-filter: saturate(1.2) blur(10px);
    }
    .btn {
      display: inline-flex; justify-content: center; align-items: center; gap: 8px; height: var(--tap);
      background: var(--accent); color: white; border-radius: 14px; border: 1px solid color-mix(in srgb, var(--accent), #000 10%);
      font-weight: 700; letter-spacing: .3px; box-shadow: var(--shadow);
    }
    .btn.secondary { background: var(--muted); color: var(--text); border-color: var(--border); font-weight: 600; }

    /* æŠ½å±‰ï¼ˆæ·»åŠ é“¾æ¥ï¼‰ */
    .sheet {
      position: fixed; inset: 0; z-index: 50; display: none; align-items: flex-end; justify-content: center;
      background: rgba(0,0,0,.38);
    }
    .sheet[open] { display: flex; }
    .panel {
      width: min(720px, 100%); background: var(--card); border: 1px solid var(--border);
      border-radius: 18px 18px 0 0; box-shadow: var(--shadow);
      padding: 14px 14px max(12px, var(--safe-bottom));
    }
    .panel h3 { margin: 2px 0 10px; font-size: 16px; }
    .field { display: grid; gap: 6px; margin-bottom: 10px; }
    .field label { font-size: 12px; color: var(--subtle); }
    .field input {
      width: 100%; background: var(--muted); color: var(--text); border: 1px solid var(--border);
      border-radius: 12px; padding: 12px 14px; font-size: 16px;
      outline: none; box-shadow: none;
    }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

    .hint { color: var(--subtle); font-size: 12px; margin-top: 6px; }

    /* ç„¦ç‚¹å¯è§†åŒ– */
    :is(button, a, input, .btn, .iconbtn):focus { outline: 2px solid var(--ring); outline-offset: 2px; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="title">æˆ‘çš„å¯¼èˆª <span class="badge" id="count">0</span></div>
    <button class="iconbtn" id="themeBtn" title="åˆ‡æ¢ä¸»é¢˜" aria-label="åˆ‡æ¢ä¸»é¢˜">ğŸŒ—</button>
    <button class="iconbtn" id="editBtn" title="ç¼–è¾‘é“¾æ¥" aria-label="ç¼–è¾‘é“¾æ¥">âœï¸</button>
  </header>

  <div class="search-wrap">
    <div class="search">
      <span aria-hidden="true">ğŸ”</span>
      <input id="q" type="search" placeholder="æœç´¢æˆ–è¾“å…¥ç½‘å€â€¦ï¼ˆæ”¯æŒç›´æ¥ç²˜è´´ URLï¼‰" />
      <span class="key">ç¼–è¾‘</span>
    </div>
  </div>

  <main class="grid" id="grid" aria-live="polite"></main>

  <nav class="toolbar" role="toolbar" aria-label="å·¥å…·æ ">
    <button class="btn secondary" id="moreBtn">æ›´å¤š</button>
    <button class="btn secondary" id="importBtn">å¯¼å…¥</button>
    <button class="btn" id="addBtn">æ·»åŠ é“¾æ¥</button>
  </nav>

  <!-- æ·»åŠ /ç¼–è¾‘ æŠ½å±‰ -->
  <dialog class="sheet" id="sheet">
    <div class="panel">
      <h3 id="sheetTitle">æ·»åŠ é“¾æ¥</h3>
      <div class="field">
        <label for="name">åç§°</label>
        <input id="name" placeholder="ä¾‹å¦‚ï¼šç™¾åº¦" />
      </div>
      <div class="field">
        <label for="url">ç½‘å€</label>
        <input id="url" placeholder="ä¾‹å¦‚ï¼šhttps://www.baidu.com" />
      </div>
      <div class="row">
        <div class="field">
          <label for="emoji">å›¾æ ‡ï¼ˆå¯ç”¨ Emojiï¼‰</label>
          <input id="emoji" placeholder="ä¾‹å¦‚ï¼šğŸ” æˆ– ğŸ“Œ" />
        </div>
        <div class="field">
          <label for="desc">ç®€è¿°ï¼ˆå¯é€‰ï¼‰</label>
          <input id="desc" placeholder="ä¾‹å¦‚ï¼šä¸­æ–‡æœç´¢å¼•æ“" />
        </div>
      </div>
      <div class="row">
        <button class="btn secondary" id="cancelBtn">å–æ¶ˆ</button>
        <button class="btn" id="saveBtn">ä¿å­˜</button>
      </div>
      <div class="hint">æç¤ºï¼šä¿å­˜åä¼šå†™å…¥æœ¬åœ°æµè§ˆå™¨ï¼ˆlocalStorageï¼‰ï¼Œä¸ä¸Šä¼ ç½‘ç»œã€‚</div>
    </div>
  </dialog>

  <script>
    // =============== ä½ å¯ä»¥åœ¨è¿™é‡Œæ”¹é»˜è®¤å¯¼èˆªï¼ˆç¤ºä¾‹ï¼‰ ===============
    const LINKS_DEFAULT = [
      { name: 'ç™¾åº¦', url: 'https://www.baidu.com', icon: 'ğŸ”', desc: 'ä¸­æ–‡æœç´¢' },
      { name: 'Bilibili', url: 'https://www.bilibili.com', icon: 'ğŸ¬', desc: 'è§†é¢‘' },
      { name: 'çŸ¥ä¹', url: 'https://www.zhihu.com', icon: 'â“', desc: 'é—®ç­”' },
      { name: 'å¾®ä¿¡ç½‘é¡µç‰ˆ', url: 'https://wx.qq.com', icon: 'ğŸ’¬', desc: 'æ²Ÿé€š' },
      { name: 'Github', url: 'https://github.com', icon: 'ğŸ™', desc: 'ä»£ç ' },
      { name: 'Dribbble', url: 'https://dribbble.com', icon: 'ğŸ€', desc: 'çµæ„Ÿ' },
      { name: 'Figma', url: 'https://www.figma.com', icon: 'ğŸ¨', desc: 'åä½œè®¾è®¡' },
      { name: 'Behance', url: 'https://www.behance.net', icon: 'ğŸ§©', desc: 'ä½œå“é›†' },
      { name: 'Google', url: 'https://www.google.com', icon: 'ğŸŒ', desc: 'Search' },
    ];

    // =============== çŠ¶æ€ & å·¥å…· ===============
    const STORE_KEY = 'mobile_nav_links_v1';
    const THEME_KEY = 'mobile_nav_theme_v1';
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const state = {
      links: [],
      editing: false,
      editingIndex: null,
    };

    function saveLinks() { localStorage.setItem(STORE_KEY, JSON.stringify(state.links)); }
    function loadLinks() {
      try {
        const raw = localStorage.getItem(STORE_KEY);
        state.links = raw ? JSON.parse(raw) : [...LINKS_DEFAULT];
      } catch {
        state.links = [...LINKS_DEFAULT];
      }
    }

    // ä¸»é¢˜
    function setTheme(mode) { // mode: 'auto' | 'light' | 'dark'
      document.documentElement.setAttribute('data-theme', mode);
      localStorage.setItem(THEME_KEY, mode);
      const themeColor = getComputedStyle(document.documentElement).getPropertyValue('--bg').trim();
      const meta = document.querySelector('meta[name="theme-color"]');
      if (meta) meta.setAttribute('content', themeColor);
    }
    function initTheme() {
      const saved = localStorage.getItem(THEME_KEY) || 'auto';
      setTheme(saved);
    }

    // æ¸²æŸ“
    function render(kw='') {
      const grid = $('#grid');
      grid.innerHTML = '';
      const keyword = kw.trim().toLowerCase();
      const filtered = keyword ? state.links.filter(x => (x.name+x.url+(x.desc||'')).toLowerCase().includes(keyword)) : state.links;
      $('#count').textContent = filtered.length;

      filtered.forEach((item, idx) => {
        const tile = document.createElement('div');
        tile.className = 'tile';

        const a = document.createElement('a');
        a.href = item.url; a.target = '_blank'; a.rel = 'noopener';
        a.innerHTML = `
          <div class="emoji">${item.icon || 'ğŸ”—'}</div>
          <div class="label">${escapeHtml(item.name || 'æœªå‘½å')}</div>
          <div class="url">${escapeHtml(item.desc || item.url)}</div>
        `;
        tile.appendChild(a);

        const del = document.createElement('button');
        del.className = 'del'; del.title = 'åˆ é™¤'; del.setAttribute('aria-label','åˆ é™¤');
        del.textContent = 'âœ•';
        del.addEventListener('click', (e) => {
          e.preventDefault(); e.stopPropagation();
          const i = state.links.indexOf(item);
          if (i > -1) { state.links.splice(i, 1); saveLinks(); render($('#q').value); }
        });
        tile.appendChild(del);

        grid.appendChild(tile);
      });
    }

    // ç®€æ˜“è½¬ä¹‰
    function escapeHtml(str='') { return str.replace(/[&<>"]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s])); }

    // æ·»åŠ /ç¼–è¾‘ é¢æ¿
    function openSheet(editIndex=null) {
      const sheet = $('#sheet');
      const isEdit = editIndex !== null && editIndex !== undefined;
      state.editingIndex = isEdit ? editIndex : null;
      $('#sheetTitle').textContent = isEdit ? 'ç¼–è¾‘é“¾æ¥' : 'æ·»åŠ é“¾æ¥';

      if (isEdit) {
        const it = state.links[editIndex];
        $('#name').value = it.name || '';
        $('#url').value = it.url || '';
        $('#emoji').value = it.icon || '';
        $('#desc').value = it.desc || '';
      } else {
        $('#name').value = '';
        $('#url').value = '';
        $('#emoji').value = '';
        $('#desc').value = '';
      }

      sheet.showModal();
    }
    function closeSheet() { $('#sheet').close(); }

    // äº‹ä»¶
    function initEvents() {
      $('#editBtn').addEventListener('click', () => {
        state.editing = !state.editing;
        document.body.setAttribute('data-edit', state.editing ? '1' : '0');
        $('#editBtn').textContent = state.editing ? 'âœ…' : 'âœï¸';
      });

      $('#themeBtn').addEventListener('click', () => {
        const cur = document.documentElement.getAttribute('data-theme') || 'auto';
        const next = cur === 'auto' ? 'light' : cur === 'light' ? 'dark' : 'auto';
        setTheme(next);
        const label = next === 'auto' ? 'ğŸŒ—' : next === 'light' ? 'ğŸŒ' : 'ğŸŒš';
        $('#themeBtn').textContent = label;
      });

      $('#q').addEventListener('input', (e) => render(e.target.value));
      $('#q').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          const v = e.currentTarget.value.trim();
          if (/^https?:\/\//i.test(v)) {
            window.open(v, '_blank');
          }
        }
      });

      $('#addBtn').addEventListener('click', () => openSheet());
      $('#cancelBtn').addEventListener('click', closeSheet);
      $('#saveBtn').addEventListener('click', () => {
        const name = $('#name').value.trim() || 'æœªå‘½å';
        const url = $('#url').value.trim();
        if (!/^https?:\/\//i.test(url)) { alert('è¯·è¾“å…¥ä»¥ http:// æˆ– https:// å¼€å¤´çš„åœ°å€'); return; }
        const icon = $('#emoji').value.trim() || 'ğŸ”—';
        const desc = $('#desc').value.trim();

        const item = { name, url, icon, desc };
        if (state.editingIndex !== null) {
          state.links[state.editingIndex] = item;
        } else {
          state.links.push(item);
        }
        saveLinks(); closeSheet(); render($('#q').value);
      });

      // æ›´å¤šï¼šå¯¼å‡º / å¯¼å…¥ / æ¢å¤é»˜è®¤
      $('#moreBtn').addEventListener('click', async () => {
        const choice = await pick(['å¯¼å‡ºJSON','å¤åˆ¶JSON','æ¢å¤é»˜è®¤']);
        if (choice === 'å¯¼å‡ºJSON' || choice === 'å¤åˆ¶JSON') {
          const json = JSON.stringify(state.links, null, 2);
          try {
            await navigator.clipboard.writeText(json);
            alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
          } catch {
            // å…œåº•æ–¹æ¡ˆï¼šä¸‹è½½æ–‡ä»¶
            const blob = new Blob([json], {type:'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'nav-links.json'; a.click();
            URL.revokeObjectURL(a.href);
          }
        } else if (choice === 'æ¢å¤é»˜è®¤') {
          if (confirm('ç¡®å®šæ¢å¤é»˜è®¤ç¤ºä¾‹ï¼Ÿè¿™ä¼šè¦†ç›–ä½ å½“å‰çš„æœ¬åœ°å¯¼èˆªã€‚')) {
            state.links = [...LINKS_DEFAULT]; saveLinks(); render($('#q').value);
          }
        }
      });

      $('#importBtn').addEventListener('click', async () => {
        const text = prompt('ç²˜è´´ JSONï¼ˆ[{ name, url, icon, desc }, ...]ï¼‰ï¼š');
        if (!text) return;
        try {
          const arr = JSON.parse(text);
          if (!Array.isArray(arr)) throw new Error('æ ¼å¼é”™è¯¯');
          // åŸºç¡€æ ¡éªŒ
          const clean = arr.filter(x => x && /^https?:\/\//i.test(x.url || ''))
            .map(x => ({ name: String(x.name||'æœªå‘½å').slice(0,60), url: String(x.url), icon: String(x.icon||'ğŸ”—').slice(0,4), desc: x.desc? String(x.desc).slice(0,120): '' }));
          if (clean.length === 0) throw new Error('æ²¡æœ‰åˆæ³•é“¾æ¥');
          state.links = clean; saveLinks(); render($('#q').value);
        } catch (e) { alert('å¯¼å…¥å¤±è´¥ï¼š' + (e.message || 'è¯·æ£€æŸ¥ JSON æ ¼å¼')); }
      });

      // ç½‘æ ¼å†…ï¼šé•¿æŒ‰ç¼–è¾‘
      $('#grid').addEventListener('contextmenu', e => e.preventDefault());
      let pressTimer = null;
      $('#grid').addEventListener('touchstart', (e) => {
        const tile = e.target.closest('.tile');
        if (!tile) return;
        pressTimer = setTimeout(() => {
          state.editing = true; document.body.setAttribute('data-edit','1'); $('#editBtn').textContent = 'âœ…';
        }, 520); // é•¿æŒ‰ 520ms è¿›å…¥ç¼–è¾‘
      }, {passive:true});
      $('#grid').addEventListener('touchend', () => { clearTimeout(pressTimer); }, {passive:true});
    }

    function pick(options) {
      return new Promise(resolve => {
        const txt = options.map((x,i)=> `${i+1}. ${x}`).join('\n');
        const idx = prompt(`é€‰æ‹©ï¼š\n${txt}`);
        const n = Number(idx);
        resolve(options[n-1]);
      });
    }

    // å¯åŠ¨
    function boot() {
      initTheme();
      const mode = document.documentElement.getAttribute('data-theme');
      $('#themeBtn').textContent = mode==='dark' ? 'ğŸŒš' : mode==='light' ? 'ğŸŒ' : 'ğŸŒ—';

      loadLinks();
      initEvents();
      render();
    }

    document.addEventListener('DOMContentLoaded', boot);
  </script>
</body>
</html>
